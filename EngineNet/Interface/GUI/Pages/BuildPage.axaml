<UserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="EngineNet.Interface.GUI.Pages.BuildingPage">
    <DockPanel Margin="0,0,0,12">
        <!-- Header with operation name and clear button -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
            <TextBlock Text="Operation Output:" FontWeight="Bold" VerticalAlignment="Center"/>
            <TextBlock
                Text="{Binding Service.CurrentOperation, TargetNullValue=No operation running}"
                VerticalAlignment="Center"
                Foreground="Gray"/>
            <Button Content="Clear Output" Command="{Binding Button_ClearOutput_Click}" Margin="20,0,0,0"/>
        </StackPanel>

        <!-- Progress panel area -->
        <Border
            DockPanel.Dock="Top"
            BorderBrush="#3A3A3A"
            BorderThickness="1"
            Padding="12"
            Margin="0,0,0,12"
            Background="#101010"
            CornerRadius="4"
            IsVisible="{Binding Service.IsProgressPanelActive}">
            <StackPanel Spacing="8">
                <TextBlock Text="{Binding Service.ProgressLabel, TargetNullValue=In Progress}" FontWeight="Bold"/>
                <ProgressBar Minimum="0" Maximum="1" Height="16" Value="{Binding Service.ProgressPercent}"/>
                <TextBlock
                    Text="{Binding Service.ProgressSummaryLine}"
                    FontFamily="Consolas,Courier New,monospace"
                    Foreground="Cyan"
                    TextWrapping="Wrap"/>
                <TextBlock Text="{Binding Service.ActiveJobsSummary}" Foreground="LightGray"/>
                <ItemsControl ItemsSource="{Binding Service.ActiveJobs}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Spacing="6" Margin="0,2">
                                <TextBlock Text="{Binding Spinner}" FontFamily="Consolas,Courier New,monospace"/>
                                <TextBlock Text="{Binding Tool}" FontWeight="SemiBold"/>
                                <TextBlock Text="·" Foreground="Gray"/>
                                <TextBlock Text="{Binding File}" TextWrapping="Wrap" Width="300"/>
                                <TextBlock Text="·" Foreground="Gray"/>
                                <TextBlock Text="{Binding Elapsed}" Foreground="Gray"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Border>

        <!-- Output log display -->
        <Border BorderBrush="Gray" BorderThickness="1" Padding="8" Background="#1E1E1E">
            <ScrollViewer x:Name="OutputScroll" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                <ItemsControl ItemsSource="{Binding Service.Lines}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal" Margin="0,2">
                                <TextBlock
                                    Text="{Binding FormattedTime}"
                                    Foreground="DarkGray"
                                    FontFamily="Consolas,Courier New,monospace"
                                    Margin="0,0,8,0"
                                    Width="60"/>
                                <TextBlock
                                    Text="{Binding Text}"
                                    Foreground="{Binding Color}"
                                    FontFamily="Consolas,Courier New,monospace"
                                    TextWrapping="Wrap"
                                    Width="600"/>
                            </StackPanel>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </DockPanel>
</UserControl>
